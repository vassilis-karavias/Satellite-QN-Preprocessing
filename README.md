# Satellite-QN-Preprocessing

## Requirements
Matlab Aerospace Toolbox  
numpy  
pandas  
scipy  
graph_tool  

## How to use
To generate the access time file between ground stations and satellite paths use the matlab file: *satellite_model.m*
This models the trajectory of the satellite which can be specified by the parameters:  
*semiMajorAxis*  
*eccentricity*   
*inclination*  
*rightAscensionOfAscendingNode1 % degrees*  
*argumentOfPeriapsis % degrees*  
*trueAnomaly % degrees*  
for ground stations given in the lists name, lat, lon, alt. This will save a csv file with the name  
*"global_satelliteElevAngle_", gs(groundstation).Name, "_",int2str(rightAscensionOfAscendingNode1),".csv"*  


To generate the graphs for the simple model first create a  
*net = store_satellite_data_simple_graph.Store_Network_Problem(allocation_method, RAAN_list, core_station_list, ground_station_list, network_segragation, distance, n, is_local, file_path)*  
where *allocation_method* is one of ["None", "ClashFullBypass", "ClashFullBypassTransmissionModulated", "ClashFullBypassKeyModulated"] to select which type of satellite allocation scheme is used. None is for not considering any allocation problems,  “ClashFullBypass” randomly assigns the satellite to any ground station it can access for the whole bypass, “ClashFullBypassTransmissionModulated” assigns the satellite to one of the ground stations over a bypass with a probability distribution based on the expected transmission requirement to the ground station and “ClashFullBypassKeyModulated” assigns the satellite to one of the ground stations over a bypass with a probability distribution based on expected key rate. *RAAN_list* is an array of the possible satellite RAANs. *core_station_list* is a list of the subset of core sites that should be used. As standard this is None meaning all core stations in the problem are considered. *ground_station_list* is a list of the subset of ground stations that should be used. As standard this is None meaning all ground stations are considered. *network_segragation* is one of ["SingleConnection","DistanceBased", "ConnectionBased" ] and determines how to split up the underlying core nodes in the network into possible ground stations. “SingleConnection” is the shortest distance connection allocation, “DistanceBased” connects core sites to ground stations which are physically reachable and closer than distance “distance”, “ConnectionBased” connects core sites to all ground stations physically reachable independent of distance. *distance* is required only if *network_segragation== “DistanceBased”* and is the maximum distance in km between accepted ground stations and core sites. *n* is the number of sources per satellite, only useful if *allocation_method = “ClashFullBypass”*. *is_local* is a boolean with True if local network is used and False if global network is used. Should you wish to use Trasmission Modulated with the shortest distance connections scaling the coefficient, use *“SingleConnection”* when calculating the key rates, if you want to use the average contribution of core sites use *"ConnectionBased"* or *"DistanceBased"*. Once the satellite rate files are generated, you can get the remaining desired .csv files by rerunning the method with the new *network_segragation*. Note that the program is set to work on the global network currently – to change to the local network, sections labelled “Local Data” in files *satellite_utils.py, generate_graphs_for_satellite_problem.py* and *satellite_rate_calculator.py* should be uncommented, and the corresponding sections labelled “Global Data” in those files should be commented. *file_path* is the preamble of the file that stores the data for the ground station to satellite access time generated by the *satellite_model.m* file. The form of this is file is  

*file_path + f"_ground_station_RAAN.csv"*  
By default, this is *"global_satelliteElevAngle"*  
To store the .csv file for the key rate between satellite and ground stations use the method  
*net.store_rate_satellite_ground_station_file(file_path, graph_id )*  
while to store the .csv file for the required transmission rate between ground station sites use the method  
*net.store_simple_Tij_file(file_path , graph_id )*  
file_path is the file name that you want to store the file in excluding the .csv and graph_id is the current graph’s id which is 0 for the first graph.   

To generate the graphs for the full optimisation again create a  
*net = store_satellite_data_simple_graph.Store_Network_Problem(allocation_method, RAAN_list, core_station_list, ground_station_list, network_segragation, distance, n, is_local)*  
To store the .csv file for the key rate between satellite and ground stations use the method  
*net.store_rate_satellite_ground_station_file(file_path, graph_id)*  
To store the transmission requirement file between core sites use the method  
*net.store_Tij_file(file_path, graph_id )*  
To store the key dict file use the method   
*net.store_key_dict_file(file_path, graph_id)*  
Finally to store the file containing which ground stations are allowed per core site use the method  
*net.store_core_site_keys(file_path, graph_id)*  

Based on SatQuMA version 2.0.0 (May 2023 - https://github.com/cnqo-qcomms/SatQuMA) modified 2023 by adapting to allow multiple paths, which have been generated in a file, and multiple ground stations.
